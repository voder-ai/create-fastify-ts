# 007.0-DEVELOPER-LINT-FORMAT: Verify and Fix Code Quality with Linting and Formatting

## Release Goal

**Production-Ready Foundation** - Enable developers to get from zero to working API server in under 30 seconds with a single npm init command.

This story ensures code quality tools work seamlessly, allowing developers to verify their code meets quality standards and automatically fix style issues. It connects to the "Verify Setup" journey phase where developers confirm that quality tooling works correctly before beginning feature development.

## How This Story Contributes

This story validates the template's code quality promise by:

- **Enforces Team Consistency**: Ensures all developers write code following the same style and quality standards
- **Fast Feedback Loop**: Provides immediate feedback on code quality issues during development
- **Reduces Review Friction**: Automatic formatting eliminates style debates in code reviews
- **Catches Common Errors**: ESLint identifies potential bugs and TypeScript issues before runtime
- **Enables CI/CD Gates**: Quality checks work reliably in automated pipelines
- **Developer Education**: Helps developers understand what makes code high-quality and maintainable

## User Story

**Format**: So that I can maintain consistent, high-quality code and automatically fix style issues without manual effort, as an API Developer, I want to verify code quality with linting and automatically format code with one command.

**INVEST Criteria Compliance**:

- **Independent**: Depends only on 002.0 (dependencies installed); can run in parallel with 003.0, 004.0, 006.0
- **Negotiable**: Specific lint rules and formatting preferences can be adjusted based on team feedback
- **Valuable**: Delivers immediate code quality feedback and automatic fixes - reduces manual formatting effort
- **Estimable**: Clear scope - run lint/format commands, see results, auto-fix works, no errors
- **Small**: Single iteration - focused on verifying and using code quality tools only
- **Testable**: Clear success criteria - lint passes, format check passes, auto-fix corrects issues, errors are understandable

## Acceptance Criteria

- [x] **Lint Check Passes**: Running `npm run lint` completes successfully with no errors on fresh template code
- [x] **Format Check Passes**: Running `npm run format:check` completes successfully with no formatting issues on fresh template code
- [x] **Lint Auto-Fix Works**: Running `npm run lint:fix` automatically corrects fixable linting issues
- [x] **Format Auto-Fix Works**: Running `npm run format` automatically formats all files to match Prettier style
- [ ] **Clear Error Messages**: When issues exist, error messages clearly identify the file, line, and problem
- [ ] **Fast Execution**: Lint and format checks complete in reasonable time (< 5 seconds for template code)
- [ ] **Understanding Lint Rules**: Developer can identify what rule was violated and why it matters
- [ ] **Understanding Format Changes**: Developer can see what formatting changes will be applied before running format

## Requirements

- **REQ-LINT-ESLINT**: ESLint checks code for quality issues, TypeScript errors, and anti-patterns
- **REQ-LINT-TYPESCRIPT**: Linter understands TypeScript syntax and can check type-related issues
- **REQ-LINT-CLEAN**: Fresh template code passes all lint checks without errors or warnings
- **REQ-LINT-FIX**: `npm run lint:fix` automatically corrects fixable issues (imports, spacing, etc.)
- **REQ-LINT-ERRORS-CLEAR**: Lint errors show file path, line number, rule name, and explanation
- **REQ-FORMAT-PRETTIER**: Prettier formats code consistently across all file types (TypeScript, JSON, Markdown)
- **REQ-FORMAT-CLEAN**: Fresh template code passes format check without requiring changes
- **REQ-FORMAT-WRITE**: `npm run format` applies formatting changes to files
- **REQ-FORMAT-CHECK-ONLY**: `npm run format:check` verifies formatting without modifying files (for CI/CD)
- **REQ-QUALITY-FAST**: Both lint and format checks complete quickly for rapid feedback
- **REQ-QUALITY-CONSISTENT**: Running lint/format multiple times produces same results (idempotent)

## Dependencies

- 002.0-DEVELOPER-DEPENDENCIES-INSTALL (ESLint, Prettier, and related packages must be installed)

## Implementation Notes

### Linting with ESLint

The `npm run lint` command should:

- Check all TypeScript files for code quality issues
- Verify TypeScript types are used correctly
- Identify potential bugs and anti-patterns
- Report fixable vs. non-fixable issues
- Exit with error code if issues found (for CI/CD integration)

The `npm run lint:fix` command should:

- Automatically fix all auto-fixable issues
- Preserve code functionality while improving style
- Report remaining issues that require manual fixes
- Update files in place with corrections

### Formatting with Prettier

The `npm run format:check` command should:

- Check if all files match Prettier formatting rules
- Report which files need formatting (without modifying them)
- Exit with error code if formatting issues found (for CI/CD integration)
- Work on TypeScript, JavaScript, JSON, Markdown, and other supported file types

The `npm run format` command should:

- Format all files to match Prettier style
- Update files in place with formatting changes
- Handle TypeScript, JavaScript, JSON, Markdown, and other file types
- Produce consistent results across different environments

### Automated Smoke Test

The `scripts/lint-format-smoke.mjs` script validates this story end-to-end by creating a temporary mini-project wired directly to the repositoryâ€™s ESLint and Prettier CLIs via their Node entry points, writing deliberately misformatted code, running the equivalent of `lint:fix` and `format`, and asserting both that the file content changes as expected and that re-running `format` is idempotent (no further changes).

### Understanding Quality Tools

**What ESLint Checks**:

- **Code Quality**: Unused variables, unreachable code, potential bugs
- **TypeScript Issues**: Type mismatches, incorrect type usage, missing types
- **Best Practices**: Proper use of async/await, error handling patterns, security issues
- **Code Style**: Naming conventions, import organization (when configured)

**What Prettier Formats**:

- **Indentation**: Consistent spacing (2 spaces by default)
- **Line Length**: Wraps long lines at reasonable breakpoints
- **Quotes**: Consistent use of single/double quotes
- **Semicolons**: Consistent semicolon usage
- **Trailing Commas**: Consistent comma placement in objects/arrays
- **Whitespace**: Consistent spacing around operators, after keywords

### Key Differences: Lint vs. Format

| Aspect         | ESLint (`npm run lint`)                  | Prettier (`npm run format`)              |
| -------------- | ---------------------------------------- | ---------------------------------------- |
| Purpose        | Code quality and correctness             | Code style and appearance                |
| Checks         | Logic errors, type issues, anti-patterns | Indentation, spacing, line breaks        |
| Auto-Fix       | Some rules (imports, simple style)       | All formatting issues                    |
| Configuration  | Extensive rule customization             | Minimal (opinionated defaults)           |
| When to Run    | Before commit, in CI/CD                  | Before commit, in editor                 |
| Typical Errors | "Unused variable", "Type mismatch"       | "Incorrect indentation", "Line too long" |

### Workflow Integration

**During Development**:

1. Write code in editor (IDE may auto-format on save)
2. Run `npm run lint` to check for quality issues
3. Fix any errors or run `npm run lint:fix` for auto-fixable issues
4. Run `npm run format` to ensure consistent formatting
5. Commit changes

**Before Committing**:

- Pre-commit hooks automatically run `lint` and `format:check`
- If checks fail, commit is blocked until issues are fixed
- Developer fixes issues and re-attempts commit

**In CI/CD Pipeline**:

- `npm run lint` runs as quality gate (fails build if errors)
- `npm run format:check` runs as quality gate (fails build if not formatted)
- Both must pass before code can be merged or released

## Definition of Done

- [x] All acceptance criteria met
- [x] `npm run lint` executes successfully with no errors on fresh template code
- [x] `npm run format:check` executes successfully with no formatting issues
- [x] `npm run lint:fix` automatically corrects fixable linting issues
- [x] `npm run format` automatically formats code consistently
- [ ] Error messages are clear and actionable
- [ ] Quality check execution time is acceptable (< 5 seconds)
- [ ] Developer understands difference between linting and formatting
- [ ] Developer knows when to use check vs. fix commands
