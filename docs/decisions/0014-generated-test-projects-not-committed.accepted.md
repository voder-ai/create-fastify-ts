# 0014 - Generated test projects must not be committed

- Status: accepted
- Date: 2025-12-14

## Context

This repository provides an npm initializer (`npm init @voder-ai/fastify-ts`) that scaffolds new Fastify + TypeScript projects. During early development, several example or test projects generated by the initializer (for example `cli-api/`, `cli-test-from-dist/`, `cli-test-project/`, `manual-cli/`, and `test-project-exec-assess/`) were committed to the repository.

While these directories were useful during initial bring-up and manual testing, keeping generated projects under version control has several drawbacks:

- They are **not source of truth** for the initializer behaviour; the real contract is the template files in `src/template-files/` and the initializer/CLI code.
- They quickly become **stale** as the initializer evolves, creating confusion for contributors and assessors.
- They **pollute quality checks** (linters, formatters, duplication detectors) with duplicated boilerplate.
- They violate the general guidance for generators and initializers: tests should create projects in **temporary directories** and clean them up, not rely on committed generated trees.

## Decision

1. **Generated test projects must never be committed to the repository.**
   - Directories such as `cli-api/`, `cli-test-from-dist/`, `cli-test-project/`, `manual-cli/`, and `test-project-exec-assess/` are considered _generated artifacts_ and must not live in git.
   - Any future generated project used for testing must follow the same rule.

2. **Tests must create their own projects in temporary directories.**
   - Initializer tests (`src/initializer.test.ts`) and CLI tests (`src/cli.test.ts`) already follow this pattern by using `fs.mkdtemp(os.tmpdir() + ...)` and cleaning up with `fs.rm(..., { recursive: true, force: true })`.
   - Dev-server tests use `src/dev-server.test-helpers.ts` to create synthetic projects in OS temp directories.
   - This pattern is the canonical approach for all tests that need a scaffolded project.

3. **Automated checks will guard against regressions.**
   - A small repository-hygiene test will fail if any of the known generated-project directory names appear at the repository root.
   - This ensures that accidentally re-committing generated projects is immediately caught during `npm test` and in CI.

## Consequences

- The working tree remains focused on **source, configuration, and intentional fixtures** only.
- Tests are responsible for creating any temporary projects they need, using OS temporary directories and cleaning up after themselves.
- Contributors have clear guidance: if they need an example project for documentation, it must be a small, manually maintained example (under a dedicated `examples/` or `fixtures/` directory) and **not** a full initializer output committed wholesale.

## Requirements

- **REQ-NO-GENERATED-PROJECTS**: No initializer-generated test projects (such as `cli-api/`, `cli-test-from-dist/`, `cli-test-project/`, `manual-cli/`, `test-project-exec-assess/`) may be committed to the repository. Tests must create such projects in temporary directories at runtime and remove them when finished.
